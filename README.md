# shri_2018_nodejs_homework

[![Build Status](https://travis-ci.org/konstantinov90/shri_2018_nodejs_homework.svg?branch=master)](https://travis-ci.org/konstantinov90/shri_2018_nodejs_homework)

-----------------------------------------------

##### Для установки приложения, как обычно:

`npm install`

-----------------------------------------------

### Линтеры:

`npm run lint`

`npm run stylelint`

-----------------------------------------------

### Юнит-тесты

`npm test`

-----------------------------------------------

### Интеграционные тесты

для интеграционных тестов на локальной машине нужно установить selenium-standalone

`npm i --global selenium-standalone`

`selenium-standalone install`

для запуска тестов нужно запустить selenium

`selenium-standalone start`

и приложение, настроенное на тестовый git-репозиторий

`npm run hermioneTestServer`

и, наконец, непосредственно тесты (с предварительным клонированием тестового репозитория и его последующим удалением):

`npm run hermioneLocal` 

скрипт `npm run hermione` предназначен для выполнения в режиме CI и настроен на внешний selenium-grid (sauceLabs)

-----------------------------------------------

### Запуск приложения в dev-режиме

`npm run dev`

### Запуск приложения в prod-режиме

`npm start`

-----------------------------------------------

# О приложении

Приложение сделано максимально примитивно (показалось достаточным для поставленной задачи, не обессудьте!) на комбинации Express.js и шаблонизатора Pug.js

Работа с git-клиентом происходит через командную строку (класс server/GitApi.js). На всякий случай в связи с этим в _Dockerfile_ включено обновление git-клиента.

Настройки приложения передаются через файл app.properties. Также есть возможность перегрузить настроечный файл, передав путь к альтернативному файлу первым аргументом в npm run (это требуется для автоматического интеграционного тестирования).

-----------------------------------------------

# CI/CD

в Travis-CI и Heroku удалось настроить следующий flow:

1. - При коммите в любую ветку происходит выполнение юнит-тестов и линтеров
   - Производится сборка докер образа и пушится в репозиторий приложения https://shri-2018-nodejs-homework-test.herokuapp.com/
   - Выполняются интеграционные тесты (гермиона) на вышеуказанном приложении
1. - При коммите в мастер ветку (без тэгов) происходит то же, что и в предыдущем пункте
   - Затем делается **pull** образа тестового приложения и **push** этого образа в _staging_ приложение https://shri-2018-nodejs-homework-stag.herokuapp.com/
1. - При коммите тэга происходит то же, что и в первом пункте
   - Затем делается **pull** образа тестового приложения и **push** этого образа в _production_ приложение https://shri-2018-nodejs-homework-prod.herokuapp.com/
1. - Pull-реквесты обрабатываются по первому пункту
   - _Review_ приложение поднимается на основании _Dockerfile_'а (сборка и запуск докер образа) полностью силами Heroku в автоматическом режиме
